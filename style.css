        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            background-color: #111;
            touch-action: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        canvas {
            display: block;
        }

        /* UI Katmanı */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            padding: 20px;
            box-sizing: border-box;
            z-index: 10;
        }

        .score-container {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
        }

        /* Kontrol Bölgeleri */
        .control-zone {
            position: absolute;
            bottom: 0;
            height: 100%;
            width: 50%;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.02);
            pointer-events: none;
            transition: background 0.1s;
        }

        #left-zone {
            left: 0;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        #right-zone {
            right: 0;
        }

        .control-zone.active {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Menüler */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* background: rgba(0, 0, 0, 0.85); REPLACED */
            background: transparent;
            z-index: 30;
            /* Enable interactions in screens */
            touch-action: auto;
            pointer-events: auto;
        }

        /* Screen content scrollable areas need pan-y */
        .shop-items-container,
        .story-container {
            touch-action: pan-y;
        }

        .hidden {
            display: none !important;
        }

        .btn {
            background: #ddd;
            color: #111;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 900;
            border-radius: 2px;
            cursor: pointer;
            box-shadow: 4px 4px 0px #333;
            transition: transform 0.1s, box-shadow 0.1s;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 10px;
            display: inline-block;
            font-family: 'Courier Prime', monospace;
        }

        .btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #333;
        }

        .btn-secondary {
            background: transparent;
            color: #888;
            border: 1px solid #444;
            font-size: 0.9rem;
            padding: 10px 30px;
            box-shadow: none;
        }

        .btn-secondary:hover {
            color: #fff;
            border-color: #fff;
        }

        input[type="text"] {
            background: transparent;
            border: none;
            border-bottom: 2px solid #555;
            color: #fff;
            font-size: 1.5rem;
            padding: 10px;
            text-align: center;
            outline: none;
            width: 200px;
            margin-bottom: 20px;
            font-family: 'Courier Prime', monospace;
            text-transform: uppercase;
            font-weight: 600;
        }

        input[type="text"]:focus {
            border-bottom-color: #fff;
        }

        .tutorial-row {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
        }

        .tut-item {
            text-align: center;
            color: #666;
        }

        .item-desc {
            font-size: 0.85rem;
            color: #ddd;
            /* Brighter for better contrast */
            line-height: 1.3;
            font-family: 'Courier Prime', monospace;
            opacity: 0.9;
        }

        .tut-icon {
            font-size: 2rem;
            color: #888;
            margin-bottom: 10px;
        }

        .tut-desc {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* HİKAYE EKRANI STİLLERİ */
        .story-container {
            width: 90%;
            max-width: 500px;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .comic-panel {
            background: #000;
            border: 2px solid #fff;
            padding: 20px;
            position: relative;
            box-shadow: 8px 8px 0 #333;
            transition: transform 0.3s;
            opacity: 0;
        }

        .comic-panel:hover {
            transform: scale(1.02);
        }

        #story-screen:not(.hidden) .comic-panel {
            animation: slideUpFade 0.6s ease-out forwards;
        }

        #story-screen:not(.hidden) .comic-panel:nth-child(1) {
            animation-delay: 0.1s;
        }

        #story-screen:not(.hidden) .comic-panel:nth-child(2) {
            animation-delay: 0.3s;
        }

        #story-screen:not(.hidden) .comic-panel:nth-child(3) {
            animation-delay: 0.5s;
        }

        .panel-number {
            position: absolute;
            top: -12px;
            left: -12px;
            background: #fff;
            color: #000;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            font-family: 'Courier Prime', monospace;
            border: 1px solid #000;
        }

        .panel-icon {
            font-size: 2rem;
            color: #555;
            margin-bottom: 15px;
            text-align: center;
        }

        .panel-text {
            font-family: 'Courier Prime', monospace;
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .highlight {
            color: #fff;
            font-weight: bold;
            text-decoration: underline decoration-dotted;
        }

        /* Noir Noise Efekti - Performance Optimization: Only on Mobile */
        .film-grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            opacity: 0.05;
            /* Default: No grain on Desktop to prevent lag */
            background-image: none;
        }

        @media (max-width: 768px) {
            .film-grain {
                background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            }
        }

        /* Difficulty Buttons */
        .difficulty-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn-difficulty {
            background: transparent;
            color: #666;
            border: 1px solid #444;
            padding: 8px 16px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Courier Prime', monospace;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .btn-difficulty:hover {
            border-color: #888;
            color: #aaa;
        }

        .btn-difficulty.active {
            color: #fff;
            border-color: #fff;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        /* SCOREBOARD STİLLERİ */
        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            justify-content: center;
        }

        .tab-btn {
            background: transparent;
            color: #666;
            border-bottom: 2px solid #333;
            padding: 10px 20px;
            font-size: 0.9rem;
            cursor: pointer;
            font-family: 'Courier Prime', monospace;
            text-transform: uppercase;
        }

        .tab-btn.active {
            color: #fff;
            border-bottom: 2px solid #fff;
        }

        .score-list {
            width: 100%;
            text-align: left;
            margin-bottom: 20px;
        }

        .score-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #333;
            color: #aaa;
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
        }

        .score-row:first-child {
            color: #fff;
            /* En yüksek skor parlak */
            font-weight: bold;
        }

        /* MAĞAZA STİLLERİ */
        .shop-balance {
            font-size: 1.5rem;
            color: #39FF14;
            font-family: 'Courier Prime', monospace;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(57, 255, 20, 0.5);
        }

        /* SHOP GRID LAYOUT */
        .shop-items-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            /* Slightly wider minimum for better readability */
            gap: 20px;
            width: 100%;
            max-width: 800px;
            margin-bottom: 30px;
        }

        .shop-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border: 1px solid #333;
            width: 100%;
            height: 100%;
            min-height: 250px;
            /* Ensure uniform height */
            box-sizing: border-box;
            transition: all 0.2s;
            cursor: pointer;
        }

        .item-icon {
            font-size: 3rem;
            /* Bigger icons */
            margin-right: 0;
            margin-bottom: 15px;
        }

        .item-info {
            text-align: center;
            flex-grow: 1;
            margin-bottom: 15px;
        }

        .item-title {
            color: #fff;
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 1.1rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .active-buffs {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            justify-content: center;
            width: 100%;
        }

        .buff-icon {
            font-size: 0.8rem;
            padding: 2px 5px;
            border-radius: 4px;
            font-weight: bold;
            font-family: monospace;
        }

        .buff-shield {
            background: #3b82f6;
            color: white;
        }

        .buff-booster {
            background: #eab308;
            color: black;
        }

        .buff-worm {
            background: #a855f7;
            color: white;
        }

        /* Ensure buttons are clickable */
        .buy-btn,
        .btn,
        .btn-secondary,
        .tab-btn,
        .loadout-item {
            position: relative;
            z-index: 50;
            touch-action: manipulation;
            cursor: pointer;
        }

        .buy-btn {
            font-family: 'Courier Prime', monospace;
            font-weight: 900;
            font-size: 1.3rem !important;
            color: #39FF14 !important;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #39FF14;
            padding: 12px;
            width: 100%;
            text-shadow: 0 0 10px rgba(57, 255, 20, 0.8);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            letter-spacing: 1px;
            transition: all 0.2s;
            margin-top: auto;
        }

        .buy-btn:hover {
            background: #39FF14;
            color: #000 !important;
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.6);
            text-shadow: none;
        }

        .shop-icon-img {
            width: 64px;
            height: 64px;
        }

        /* Responsive Fix for Buttons inside Grid */
        .buy-btn,
        .btn-secondary {
            width: 100%;
            font-size: 0.9rem;
            padding: 10px;
        }


        /* STORY MODE CAROUSEL */
        .story-scene {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 500px;
            /* Mobile friendly frame */
            animation: fadeIn 0.5s;
        }

        .story-scene.active {
            display: flex;
        }

        .story-img-container {
            width: 100%;
            aspect-ratio: 1/1;
            margin-bottom: 20px;
            border: 4px solid #fff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            overflow: hidden;
            position: relative;
            background: #000;
        }

        .story-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .story-caption {
            background: #111;
            color: #ccc;
            padding: 15px;
            border-left: 4px solid #39FF14;
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .story-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* LOADOUT SYSTEM */
        .loadout-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .loadout-item {
            position: relative;
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #444;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .loadout-item img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            filter: grayscale(100%) opacity(0.5);
            transition: all 0.2s;
        }

        .loadout-item:active {
            transform: scale(0.95);
        }

        /* Owned but not selected */
        .loadout-item.owned {
            border-color: #666;
        }

        .loadout-item.owned img {
            filter: grayscale(0%) opacity(0.8);
        }

        /* Selected / Equipped */
        .loadout-item.selected {
            border-color: #39FF14;
            background: rgba(57, 255, 20, 0.15);
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.4);
        }

        .loadout-item.selected img {
            filter: drop-shadow(0 0 5px #39FF14) grayscale(0%) opacity(1);
            transform: scale(1.1);
        }

        .loadout-count {
            position: absolute;
            bottom: -8px;
            right: -8px;
            background: #222;
            color: #fff;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            font-family: 'Courier Prime', monospace;
            border: 1px solid #555;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        /* NEW TITLE FRAME STYLE */
        .title-frame {
            position: relative;
            padding: 20px 40px;
            margin-bottom: 2.5rem;
            text-align: center;
            border: 3px solid #39FF14;
            border: 3px solid #39FF14;
            /* background: rgba(0, 0, 0, 0.6); REMOVE to let bg show, or keep semi-transparent? User said bg layer is BEHIND. Title frame should probably keep its own bg for readability. */
            background: rgba(0, 0, 0, 0.7);
            /* Cracked/Tech look with clip-path */
            clip-path: polygon(0% 0%,
                    15% 0%, 20% 10%, 25% 0%,
                    /* Top crack */
                    90% 0%, 100% 20%,
                    100% 100%,
                    80% 100%, 75% 90%, 70% 100%,
                    /* Bottom crack */
                    10% 100%, 0% 80%
                    /* Left corner cut */
                );
            box-shadow: 0 0 25px rgba(57, 255, 20, 0.2), inset 0 0 15px rgba(57, 255, 20, 0.1);
        }

        .title-frame::before {
            /* Extra decoration lines for more "cracked" feel */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 1px solid rgba(57, 255, 20, 0.5);
            clip-path: polygon(0% 20%, 5% 20%, 5% 0%, 95% 0%, 95% 20%, 100% 20%, 100% 80%, 95% 80%, 95% 100%, 5% 100%, 5% 80%, 0% 80%);
            margin: -6px;
            z-index: -1;
            opacity: 0.6;
        }

        .main-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            text-shadow: 0 0 15px #39FF14;
            margin: 0;
            line-height: 1.1;
        }

        .sub-title {
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
            color: #fff;
            text-shadow: 0 0 5px #39FF14;
            margin-top: 5px;
            display: block;
        }

        @media (min-width: 768px) {
            .main-title {
                font-size: 5rem;
            }

            .sub-title {
                font-size: 1.2rem;
            }

            .title-frame {
                padding: 30px 60px;
            }
        }

        /* --- ANIMATIONS --- */
        .title-frame {
            animation: neon-pulse 4s infinite ease-in-out;
        }



        @keyframes neon-pulse {

            0%,
            100% {
                box-shadow: 0 0 25px rgba(57, 255, 20, 0.2), inset 0 0 15px rgba(57, 255, 20, 0.1);
                border-color: rgba(57, 255, 20, 0.7);
            }

            50% {
                box-shadow: 0 0 50px rgba(57, 255, 20, 0.5), inset 0 0 30px rgba(57, 255, 20, 0.3);
                border-color: rgba(57, 255, 20, 1);
            }
        }

        /* COMBO SYSTEM UI */
        #combo-display {
            font-family: 'Courier Prime', monospace;
            font-weight: bold;
            font-size: 24px;
            color: #39FF14;
            margin-top: 5px;
            text-align: right;
            opacity: 0;
            transition: opacity 0.3s;
            text-shadow: 0 0 10px rgba(57, 255, 20, 0.5);
        }

        #combo-display.active {
            opacity: 1;
            animation: combo-pulse 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes combo-pulse {
            0% {
                transform: scale(1.0);
            }

            50% {
                transform: scale(1.3);
            }

            100% {
                transform: scale(1.0);
            }
        }

        /* DYNAMIC MENU BACKGROUND */
        #menu-background-layer {
            position: absolute;
            top: -5%;
            left: -5%;
            width: 110%;
            height: 110%;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: brightness(0.2) blur(8px);
            animation: bg-pan 25s ease-in-out infinite alternate;
            transition: background-image 1.5s ease-in-out;
            pointer-events: none;
            will-change: transform;
        }

        @keyframes bg-pan {
            0% {
                transform: scale(1.0) translate(0%, 0%);
            }

            100% {
                transform: scale(1.2) translate(-4%, -2%);
            }
        }

        /* TOAST NOTIFICATIONS */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast-notification {
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #39FF14;
            color: #fff;
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
            font-family: 'Courier Prime', monospace;
            min-width: 280px;
            animation: toast-slide-in 0.3s ease-out forwards, toast-slide-out 0.3s ease-in 3.5s forwards;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast-icon {
            font-size: 24px;
            color: #39FF14;
        }

        .toast-content {
            display: flex;
            flex-direction: column;
        }

        .toast-title {
            font-weight: bold;
            font-size: 14px;
            color: #39FF14;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .toast-message {
            font-size: 12px;
            color: #ccc;
            margin-top: 2px;
        }

        @keyframes toast-slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes toast-slide-out {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }


        /* BADGES GRID STYLES */
        .badge-grid-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #333;
            padding: 15px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            opacity: 0.7;
            transition: all 0.2s;
            min-height: 100px;
        }

        .badge-grid-item.unlocked {
            border-color: #39FF14;
            background: rgba(57, 255, 20, 0.05);
            opacity: 1;
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.1);
        }

        .badge-icon {
            font-size: 2rem;
            color: #555;
            margin-right: 15px;
            min-width: 50px;
            text-align: center;
        }

        .badge-grid-item.unlocked .badge-icon {
            color: #39FF14;
            text-shadow: 0 0 10px #39FF14;
            animation: pulse-badge 2s infinite;
        }

        .badge-info {
            flex-grow: 1;
        }

        .badge-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .badge-grid-item.unlocked .badge-title {
            color: #fff;
        }

        .badge-desc {
            font-family: 'Courier Prime', monospace;
            font-size: 0.75rem;
            color: #666;
            line-height: 1.2;
        }

        .badge-grid-item.unlocked .badge-desc {
            color: #aaa;
        }

        @keyframes pulse-badge {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        /* OVERLAYS */
        /* BADGES GRID STYLES */
        .badge-grid-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #333;
            padding: 15px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            opacity: 0.7;
            transition: all 0.2s;
            min-height: 100px;
        }

        .badge-grid-item.unlocked {
            border-color: #39FF14;
            background: rgba(57, 255, 20, 0.05);
            opacity: 1;
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.1);
        }

        .badge-icon {
            font-size: 2rem;
            color: #555;
            margin-right: 15px;
            min-width: 50px;
            text-align: center;
        }

        .badge-grid-item.unlocked .badge-icon {
            color: #39FF14;
            text-shadow: 0 0 10px #39FF14;
            animation: pulse-badge 2s infinite;
        }

        .badge-info {
            flex-grow: 1;
        }

        .badge-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .badge-grid-item.unlocked .badge-title {
            color: #fff;
        }

        .badge-desc {
            font-family: 'Courier Prime', monospace;
            font-size: 0.75rem;
            color: #666;
            line-height: 1.2;
        }

        .badge-grid-item.unlocked .badge-desc {
            color: #aaa;
        }

        @keyframes pulse-badge {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }